"use strict";(self.webpackChunksenai=self.webpackChunksenai||[]).push([[5363],{1547:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>l,contentTitle:()=>i,default:()=>u,frontMatter:()=>o,metadata:()=>c,toc:()=>d});var a=s(4848),r=s(8453);const o={title:"Aula 14-05",sidebar_position:3},i=void 0,c={id:"Aulas/ComputacaoNuvem/aula3",title:"Aula 14-05",description:"---",source:"@site/docs/Aulas/ComputacaoNuvem/aula3.md",sourceDirName:"Aulas/ComputacaoNuvem",slug:"/Aulas/ComputacaoNuvem/aula3",permalink:"/gh-senai-ads-castro/docs/Aulas/ComputacaoNuvem/aula3",draft:!1,unlisted:!1,editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/Aulas/ComputacaoNuvem/aula3.md",tags:[],version:"current",sidebarPosition:3,frontMatter:{title:"Aula 14-05",sidebar_position:3},sidebar:"tutorialSidebar",previous:{title:"Aula 30-04",permalink:"/gh-senai-ads-castro/docs/Aulas/ComputacaoNuvem/aula2"},next:{title:"Cybersecurity",permalink:"/gh-senai-ads-castro/docs/category/cybersecurity"}},l={},d=[{value:"1. Aplica\xe7\xe3o React JS [Web]",id:"1-aplica\xe7\xe3o-react-js-web",level:2},{value:"Passos:",id:"passos",level:3},{value:"Portas no Docker:",id:"portas-no-docker",level:4},{value:"2. Kubernetes Play",id:"2-kubernetes-play",level:2},{value:"In\xedcio da Inst\xe2ncia",id:"in\xedcio-da-inst\xe2ncia",level:3},{value:"Comandos executados:",id:"comandos-executados",level:3},{value:"Verifica\xe7\xe3o:",id:"verifica\xe7\xe3o",level:3},{value:"Conceitos de Networking no Kubernetes:",id:"conceitos-de-networking-no-kubernetes",level:2},{value:"Executar um comando curl via Busybox no Kubernetes:",id:"executar-um-comando-curl-via-busybox-no-kubernetes",level:3}];function t(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n.hr,{}),"\n",(0,a.jsx)(n.h1,{id:"aula-14-05-comnuv",children:"Aula 14-05 ComNuv"}),"\n",(0,a.jsx)(n.h2,{id:"1-aplica\xe7\xe3o-react-js-web",children:"1. Aplica\xe7\xe3o React JS [Web]"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Deploy e Workflow"}),": A aplica\xe7\xe3o foi comitada na branch ",(0,a.jsx)(n.code,{children:"main"})," e agora deve ser publicada no ",(0,a.jsx)(n.strong,{children:"Render"}),".","\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:["Utiliza\xe7\xe3o de ",(0,a.jsx)(n.strong,{children:"Docker"})," com uma imagem de ",(0,a.jsx)(n.strong,{children:"Express"}),"."]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Github Actions"})," para automa\xe7\xe3o do pipeline."]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Docker Hub"})," para armazenar a imagem:","\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"A tag ser\xe1 din\xe2mica, gerada a partir da aplica\xe7\xe3o."}),"\n"]}),"\n"]}),"\n",(0,a.jsxs)(n.li,{children:["Deploy final no ",(0,a.jsx)(n.strong,{children:"Render"}),"."]}),"\n",(0,a.jsxs)(n.li,{children:["\xc9 recomendada a cria\xe7\xe3o de uma camada ",(0,a.jsx)(n.strong,{children:"API"})," (opcional, mas uma boa pr\xe1tica)."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,a.jsxs)(n.p,{children:["Dentro do ",(0,a.jsx)(n.strong,{children:"Github"}),", um workflow ser\xe1 criado para ",(0,a.jsx)(n.strong,{children:"for\xe7ar a imagem"})," no reposit\xf3rio. Isso \xe9 semelhante ao workflow que j\xe1 foi utilizado no ",(0,a.jsx)(n.strong,{children:"Docusaurus"})," em outra aula."]}),"\n",(0,a.jsx)(n.h3,{id:"passos",children:"Passos:"}),"\n",(0,a.jsxs)(n.ol,{children:["\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsx)(n.p,{children:"Criar a aplica\xe7\xe3o com o seguinte comando:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"npx create-react-app --template typescript exemplo-build-ui\ncd exemplo-build-ui\n"})}),"\n"]}),"\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"Arquivo YAML"})," para o Github Actions:"]}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Secrets do Github"}),": Adicionar as chaves de ambiente (",(0,a.jsx)(n.code,{children:"API keys"}),", ",(0,a.jsx)(n.code,{children:"Docker credentials"}),", etc.) dentro de ",(0,a.jsx)(n.code,{children:"Settings > Secrets"})," no reposit\xf3rio."]}),"\n",(0,a.jsxs)(n.li,{children:["No ",(0,a.jsx)(n.strong,{children:"Docker Hub"}),", gerar uma ",(0,a.jsx)(n.strong,{children:"Access Key"}),":","\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:["Salvar essa chave e associ\xe1-la aos ",(0,a.jsx)(n.strong,{children:"Secrets"})," do Github."]}),"\n"]}),"\n"]}),"\n",(0,a.jsxs)(n.li,{children:["Executar o ",(0,a.jsx)(n.strong,{children:"docker push"})," para enviar a imagem ao Docker Hub."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,a.jsx)(n.h4,{id:"portas-no-docker",children:"Portas no Docker:"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"0-1023"}),": Portas baixas."]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"1024-65535"}),": Portas altas."]}),"\n"]}),"\n",(0,a.jsx)(n.hr,{}),"\n",(0,a.jsx)(n.h2,{id:"2-kubernetes-play",children:"2. Kubernetes Play"}),"\n",(0,a.jsx)(n.h3,{id:"in\xedcio-da-inst\xe2ncia",children:"In\xedcio da Inst\xe2ncia"}),"\n",(0,a.jsxs)(n.p,{children:["Dentro do ",(0,a.jsx)(n.strong,{children:"Kubernetes Play"}),", iniciamos a inst\xe2ncia e copiamos o c\xf3digo para executar os comandos."]}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:["O ",(0,a.jsx)(n.code,{children:"kubectl"})," traduz os comandos para requisi\xe7\xf5es que a ",(0,a.jsx)(n.strong,{children:"API dos nodes"})," executa. O ",(0,a.jsx)(n.code,{children:"kubeadm"})," normalmente \xe9 usado para criar o cluster ou reinicializ\xe1-lo."]}),"\n"]}),"\n",(0,a.jsx)(n.h3,{id:"comandos-executados",children:"Comandos executados:"}),"\n",(0,a.jsxs)(n.ol,{children:["\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"Inicializar o cluster no master node"}),":"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"kubeadm init --apiserver-advertise-address $(hostname -i) --pod-network-cidr 10.5.0.0/16\n"})}),"\n"]}),"\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"Inicializar a rede do cluster"}),":"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"kubectl apply -f https://raw.githubusercontent.com/cloudnativelabs/kube-router/master/daemonset/kubeadm-kuberouter.yaml\n"})}),"\n"]}),"\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"Criar um deployment do NGINX (opcional)"}),":"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"kubectl apply -f https://raw.githubusercontent.com/kubernetes/website/master/content/en/examples/application/nginx-app.yaml\n"})}),"\n"]}),"\n"]}),"\n",(0,a.jsxs)(n.p,{children:["Executamos o c\xf3digo do ",(0,a.jsx)(n.strong,{children:"passo 1"}),", que gerou um ",(0,a.jsx)(n.strong,{children:"c\xf3digo de join"}),". Esse c\xf3digo foi utilizado na segunda inst\xe2ncia para adicionar o node:"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"kubeadm join 192.168.0.23:6443 --token g0k0bu.5lgwumf2ehpt1iel \\\n    --discovery-token-ca-cert-hash sha256:f45942f2acb5ea840d4386c66542272575fb12a3ff95a2e91206a3d80d7e4b51\n"})}),"\n",(0,a.jsxs)(n.p,{children:["Agora temos duas m\xe1quinas: uma configurada como ",(0,a.jsx)(n.strong,{children:"master node"})," e outra como ",(0,a.jsx)(n.strong,{children:"work node"}),"."]}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Cluster Quorum"}),": Pode haver mais de uma master, mas deve-se levar em considera\xe7\xe3o o quorum para tomada de decis\xf5es no cluster."]}),"\n"]}),"\n",(0,a.jsx)(n.h3,{id:"verifica\xe7\xe3o",children:"Verifica\xe7\xe3o:"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:["Executamos o ",(0,a.jsx)(n.strong,{children:"comando 3"})," no master."]}),"\n",(0,a.jsxs)(n.li,{children:["Com os comandos ",(0,a.jsx)(n.code,{children:"kubectl get node"})," e ",(0,a.jsx)(n.code,{children:"kubectl get pods"}),", verificamos que o sistema cria automaticamente novos pods se algum for deletado, gra\xe7as \xe0 configura\xe7\xe3o de ",(0,a.jsx)(n.strong,{children:"replicas: 3"}),", que garante a exist\xeancia de 3 inst\xe2ncias da aplica\xe7\xe3o."]}),"\n"]}),"\n",(0,a.jsx)(n.hr,{}),"\n",(0,a.jsx)(n.h2,{id:"conceitos-de-networking-no-kubernetes",children:"Conceitos de Networking no Kubernetes:"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Cluster IP"}),": Endere\xe7o IP usado para comunica\xe7\xe3o dentro do cluster."]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Node Port"}),": Permite acesso externo ao servi\xe7o em uma porta espec\xedfica."]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Load Balancer"}),": Distribui o tr\xe1fego entre os nodes."]}),"\n"]}),"\n",(0,a.jsx)(n.h3,{id:"executar-um-comando-curl-via-busybox-no-kubernetes",children:"Executar um comando curl via Busybox no Kubernetes:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"kubectl run curl-cmd \\\n--image=radial/busyboxplus:curl \\\n-i --tty --rm\n"})}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsxs)(n.p,{children:["Executamos o comando acima para testar o acesso ao servi\xe7o NGINX via ",(0,a.jsx)(n.strong,{children:"curl"})," no endere\xe7o:"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-http",children:"http://192.168.0.23:30251\n"})}),"\n"]}),"\n"]}),"\n",(0,a.jsx)(n.hr,{})]})}function u(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(t,{...e})}):t(e)}},8453:(e,n,s)=>{s.d(n,{R:()=>i,x:()=>c});var a=s(6540);const r={},o=a.createContext(r);function i(e){const n=a.useContext(o);return a.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:i(e.components),a.createElement(o.Provider,{value:n},e.children)}}}]);